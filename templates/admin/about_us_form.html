{% extends 'admin/base.html' %}
{% block content %}
<h1>{% if action=='create' %}Create About Us{% else %}Edit About Us{% endif %}</h1>
<form method="post" enctype="multipart/form-data" action="{% if action=='create' %}/admin/about-us{% else %}/admin/about-us/{{ item.id }}{% endif %}">
  <div class="form-group">
    <label>Heading</label>
    <input type="text" name="heading" class="form-control" value="{{ item.heading if item else '' }}" required />
  </div>
  <div class="form-group">
    <label>Description</label>
    <textarea name="description" class="form-control">{{ item.description if item else '' }}</textarea>
  </div>
  <div class="form-group">
    <label>Vision Heading</label>
    <input type="text" name="vision_heading" class="form-control" value="{{ item.vision_heading if item else '' }}" />
  </div>
  <div class="form-group">
    <label>Vision Description</label>
    <textarea name="vision_desc" class="form-control">{{ item.vision_desc if item else '' }}</textarea>
  </div>
  <div class="form-group">
    <label>Mission</label>
    <textarea name="mission" class="form-control">{{ item.mission if item else '' }}</textarea>
  </div>
  <div class="form-group">
    <label>Bottom Heading</label>
    <input type="text" name="bottom_heading" class="form-control" value="{{ item.bottom_heading if item else '' }}" />
  </div>
  <div class="form-group">
    <label>Bottom Description</label>
    <textarea name="bottom_desc" class="form-control">{{ item.bottom_desc if item else '' }}</textarea>
  </div>
  <div class="form-group">
    <label>Bottom List (comma-separated)</label>
    <input type="text" name="bottom_list" class="form-control" value="{{ item.bottom_list if item else '' }}" />
  </div>
  <div class="form-group">
    <label>Feature Title</label>
    <input type="text" name="feature_title" class="form-control" value="{{ item.feature_title if item else '' }}" />
  </div>
  <div class="form-group">
    <label>Feature Description</label>
    <textarea name="feature_desc" class="form-control">{{ item.feature_desc if item else '' }}</textarea>
  </div>
  {# Position removed per request; ordering handled elsewhere if needed #}
  <div class="form-check">
    <input type="checkbox" name="is_featured" value="true" {% if item and item.is_featured %}checked{% endif %} /> Featured
  </div>
  <div class="form-check">
    <input type="checkbox" name="is_active" value="true" {% if item and item.is_active %}checked{% endif %} /> Active
  </div>
  <hr />
  <h3>Section Images</h3>
  <p class="text-muted">Upload images used in the About Us section. Existing images are shown below â€” you can remove them.</p>
  {% if about_images %}
  <div class="mb-2">
    {% for img in about_images %}
    <div class="d-flex align-items-center mb-1">
      <img src="{{ img.url }}" alt="about image" style="max-height:80px;margin-right:8px;border:1px solid #ddd;padding:4px;" />
      <div>
        <label class="form-check-label">
          <input type="checkbox" name="image_delete[]" value="{{ img.id }}" /> Delete
        </label>
      </div>
    </div>
    {% endfor %}
  </div>
  {% endif %}
  <div class="form-group mb-3">
    <label>Upload Section Images (multiple)</label>
    <input type="file" name="about_images[]" multiple class="form-control" />
  </div>
  <h3>Featured Cards</h3>
  <p class="text-muted">Manage small feature cards associated with this About Us section.</p>
  <div id="featured-cards-wrapper">
    {% if item and item.featured_cards %}
      {% for card in item.featured_cards %}
      <div class="card mb-2 p-2 featured-card-row">
        <input type="hidden" name="featured_id[]" value="{{ card.id }}" />
        <div class="mb-2">
          <label>Heading</label>
          <input type="text" name="featured_heading[]" class="form-control" value="{{ card.heading }}" />
        </div>
        <div class="mb-2">
          <label>Description</label>
          <textarea name="featured_description[]" class="form-control">{{ card.description }}</textarea>
        </div>
        <div class="mb-2 d-flex justify-content-end">
          <div class="form-check mb-2">
            <input type="checkbox" class="form-check-input" name="featured_delete[]" value="{{ card.id }}" id="del-{{ card.id }}" />
            <label class="form-check-label" for="del-{{ card.id }}">Delete</label>
          </div>
        </div>
        {% set fimgs = featured_images_map.get(card.id) if featured_images_map else None %}
        {% if fimgs %}
        <div class="mb-2">
          {% for fimg in fimgs %}
          <div class="d-flex align-items-center mb-1">
            <img src="{{ fimg.url }}" alt="featured image" style="max-height:60px;margin-right:8px;border:1px solid #ddd;padding:4px;" />
            <div>
              <label class="form-check-label">
                <input type="checkbox" name="image_delete[]" value="{{ fimg.id }}" /> Delete
              </label>
            </div>
          </div>
          {% endfor %}
        </div>
        {% endif %}
        {# Featured card image input removed per request #}
      </div>
      {% endfor %}
    {% endif %}
  </div>
  <button type="button" id="add-featured-card" class="btn btn-outline-secondary mb-3">Add Featured Card</button>

  <script>
    (function(){
      const wrapper = document.getElementById('featured-cards-wrapper');
      const addBtn = document.getElementById('add-featured-card');
      function makeRow() {
        const div = document.createElement('div');
        div.className = 'card mb-2 p-2 featured-card-row';
        div.innerHTML = `
          <input type="hidden" name="featured_id[]" value="" />
          <div class="mb-2">
            <label>Heading</label>
            <input type="text" name="featured_heading[]" class="form-control" value="" />
          </div>
          <div class="mb-2">
            <label>Description</label>
            <textarea name="featured_description[]" class="form-control"></textarea>
          </div>
          <div class="mb-2 d-flex justify-content-end">
            <button type="button" class="btn btn-danger btn-sm ms-auto remove-featured">Remove</button>
          </div>
          {# Featured card image input removed for new rows #}
        `;
        return div;
      }
      addBtn.addEventListener('click', function(){
        const row = makeRow();
        wrapper.appendChild(row);
        row.querySelector('.remove-featured').addEventListener('click', function(){ row.remove(); });
      });
      // attach remove handlers for any initial rows that have Remove buttons
      document.querySelectorAll('.remove-featured').forEach(function(btn){
        btn.addEventListener('click', function(){ btn.closest('.featured-card-row').remove(); });
      });
    })();
  </script>

  <button class="btn btn-primary" type="submit">Save</button>
</form>
{% endblock %}