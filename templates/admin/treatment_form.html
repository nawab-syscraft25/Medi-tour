{% extends "base.html" %}

{% block title %}{{ action }} Treatment - Admin Panel{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="fas fa-procedures"></i> {{ action }} Treatment</h2>
    <a href="/admin/treatments" class="btn btn-secondary">
        <i class="fas fa-arrow-left"></i> Back to Treatments
    </a>
</div>

<div class="row">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">Treatment Information</h5>
            </div>
            <div class="card-body">
                <form method="POST" action="/admin/treatments{% if treatment %}/{{ treatment.id }}{% endif %}" enctype="multipart/form-data">
                    <!-- Basic Information -->
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="name" class="form-label">Treatment Name <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="name" name="name" 
                                   value="{{ treatment.name if treatment else '' }}" required
                                   placeholder="Cardiac Bypass Surgery">
                            <div class="form-text">Full treatment name</div>
                        </div>
                        <div class="col-md-6">
                            <label for="treatment_type" class="form-label">Treatment Type <span class="text-danger">*</span></label>
                            <div class="input-group">
                                <select class="form-select" id="treatment_type" name="treatment_type" required>
                                    <option value="">Select Type</option>
                                    {% for type in treatment_types %}
                                    <option value="{{ type }}" {% if treatment and treatment.treatment_type == type %}selected{% endif %}>{{ type }}</option>
                                    {% endfor %}
                                </select>
                                <button type="button" class="btn btn-outline-success" onclick="showNewTypeModal()" title="Add New Type">
                                    <i class="fas fa-plus"></i>
                                </button>
                                <button type="button" class="btn btn-outline-warning" onclick="showRenameTypeModal()" title="Rename Selected Type" id="renameTypeBtn" disabled>
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button type="button" class="btn btn-outline-danger" onclick="showDeleteTypeModal()" title="Delete Selected Type" id="deleteTypeBtn" disabled>
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                            <div class="form-text">
                                <i class="fas fa-info-circle text-primary"></i> 
                                Select a type to rename or delete it. Add new types with the + button.
                            </div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="short_description" class="form-label">Short Description <span class="text-danger">*</span></label>
                        <textarea class="form-control" id="short_description" name="short_description" rows="2" required
                                  placeholder="Brief overview of the treatment procedure...">{{ treatment.short_description if treatment else '' }}</textarea>
                        <div class="form-text">Brief summary for listings (max 200 characters)</div>
                    </div>

                    <div class="mb-3">
                        <label for="long_description" class="form-label">Detailed Description</label>
                        <textarea class="form-control" id="long_description" name="long_description" rows="6"
                                  placeholder="Comprehensive description including procedure details, benefits, risks, recovery time...">{{ treatment.long_description if treatment else '' }}</textarea>
                        <div class="form-text">Comprehensive treatment information</div>
                    </div>

                    <!-- Location & Provider -->
                    <h5 class="mb-3 text-primary">
                        <i class="fas fa-map-marker-alt"></i> Location & Provider
                    </h5>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="location" class="form-label">Location <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="location" name="location" 
                                   value="{{ treatment.location if treatment else '' }}" required
                                   placeholder="City, State, Country">
                            <div class="form-text">Treatment location</div>
                        </div>
                        <div class="col-md-6">
                            <label for="hospital_id" class="form-label">Hospital</label>
                            <select class="form-select" id="hospital_id" name="hospital_id">
                                <option value="">Select Hospital</option>
                                {% for hospital in hospitals %}
                                <option value="{{ hospital.id }}" 
                                        {% if treatment and treatment.hospital_id == hospital.id %}selected{% endif %}>
                                    {{ hospital.name }}
                                </option>
                                {% endfor %}
                            </select>
                            <div class="form-text">Primary hospital (if applicable)</div>
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="other_hospital_name" class="form-label">Other Hospital Name</label>
                            <input type="text" class="form-control" id="other_hospital_name" name="other_hospital_name" 
                                   value="{{ treatment.other_hospital_name if treatment else '' }}" 
                                   placeholder="Enter hospital name if not in list">
                            <div class="form-text">If hospital not in dropdown list</div>
                        </div>
                        <div class="col-md-6">
                            <label for="doctor_id" class="form-label">Doctor</label>
                            <select class="form-select" id="doctor_id" name="doctor_id">
                                <option value="">Select Doctor</option>
                                {% for doctor in doctors %}
                                <option value="{{ doctor.id }}" 
                                        {% if treatment and treatment.doctor_id == doctor.id %}selected{% endif %}>
                                    {{ doctor.name }} - {{ doctor.designation }}
                                </option>
                                {% endfor %}
                            </select>
                            <div class="form-text">Primary doctor (if applicable)</div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="other_doctor_name" class="form-label">Other Doctor Name</label>
                        <input type="text" class="form-control" id="other_doctor_name" name="other_doctor_name" 
                               value="{{ treatment.other_doctor_name if treatment else '' }}" 
                               placeholder="Enter doctor name if not in list">
                        <div class="form-text">If doctor not in dropdown list</div>
                    </div>

                    <!-- Pricing Information -->
                    <h5 class="mb-3 text-primary">
                        <i class="fas fa-dollar-sign"></i> Pricing Information
                    </h5>
                    
                    <div class="row mb-3">
                        <div class="col-md-12 mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="price_type" id="price_range" value="range" 
                                       {% if treatment and (treatment.price_min or treatment.price_max) %}checked{% endif %}>
                                <label class="form-check-label" for="price_range">
                                    Price Range
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="price_type" id="price_exact_radio" value="exact"
                                       {% if treatment and treatment.price_exact %}checked{% endif %}>
                                <label class="form-check-label" for="price_exact_radio">
                                    Exact Price
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="row mb-3" id="price_range_fields">
                        <div class="col-md-6">
                            <label for="price_min" class="form-label">Minimum Price ($)</label>
                            <input type="number" class="form-control" id="price_min" name="price_min" 
                                   value="{{ treatment.price_min if treatment else '' }}" min="0" step="0.01"
                                   placeholder="1000.00">
                            <div class="form-text">Starting price range</div>
                        </div>
                        <div class="col-md-6">
                            <label for="price_max" class="form-label">Maximum Price ($)</label>
                            <input type="number" class="form-control" id="price_max" name="price_max" 
                                   value="{{ treatment.price_max if treatment else '' }}" min="0" step="0.01"
                                   placeholder="5000.00">
                            <div class="form-text">Maximum price range</div>
                        </div>
                    </div>

                    <div class="row mb-3" id="price_exact_field">
                        <div class="col-md-6">
                            <label for="price_exact" class="form-label">Exact Price ($)</label>
                            <input type="number" class="form-control" id="price_exact" name="price_exact" 
                                   value="{{ treatment.price_exact if treatment else '' }}" min="0" step="0.01"
                                   placeholder="2500.00">
                            <div class="form-text">Fixed treatment price</div>
                        </div>
                    </div>

                    <!-- Rating -->
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <label for="rating" class="form-label">Treatment Rating</label>
                            <div class="input-group">
                                <input type="number" class="form-control" id="rating" name="rating" 
                                       value="{{ treatment.rating if treatment else '' }}" 
                                       min="1" max="5" step="0.1" 
                                       placeholder="4.5">
                                <span class="input-group-text">
                                    <i class="fas fa-star text-warning"></i>
                                </span>
                            </div>
                            <div class="form-text">Treatment rating from 1.0 to 5.0 stars</div>
                        </div>
                    </div>

                    <!-- Images & Media -->
                    <h5 class="mb-3 text-primary">
                        <i class="fas fa-images"></i> Treatment Images
                    </h5>
                    
                    <div class="mb-3">
                        <label for="images" class="form-label">Upload Images</label>
                        <input type="file" class="form-control" id="images" name="images" multiple accept="image/*">
                        <div class="form-text">Upload procedure images, before/after photos, equipment images, etc.</div>
                    </div>

                    {% if treatment and treatment_images %}
                    <div class="mb-3">
                        <label class="form-label">Current Images</label>
                        <div class="row">
                            {% for image in treatment_images %}
                            <div class="col-md-3 mb-2">
                                <div class="card">
                                    <img src="{{ image.url }}" class="card-img-top" style="height: 150px; object-fit: cover;">
                                    <div class="card-body p-2">
                                        <small class="text-muted">
                                            {% if image.is_primary %}<i class="fas fa-star text-warning"></i> Primary{% endif %}
                                            Position: {{ image.position }}
                                        </small>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}

                    <!-- Action Buttons -->
                    <div class="d-flex justify-content-between">
                        <a href="/admin/treatments" class="btn btn-outline-secondary">
                            <i class="fas fa-times"></i> Cancel
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> {{ action }} Treatment
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Help Section -->
    <div class="col-lg-4">
        <div class="card">
            <div class="card-header">
                <h6 class="card-title mb-0"><i class="fas fa-info-circle"></i> Help & Guidelines</h6>
            </div>
            <div class="card-body">
                <h6>Required Fields</h6>
                <ul class="list-unstyled small">
                    <li><i class="fas fa-check text-success"></i> Treatment Name</li>
                    <li><i class="fas fa-check text-success"></i> Treatment Type</li>
                    <li><i class="fas fa-check text-success"></i> Short Description</li>
                    <li><i class="fas fa-check text-success"></i> Location</li>
                </ul>

                <h6 class="mt-3">Pricing Guidelines</h6>
                <ul class="list-unstyled small">
                    <li><i class="fas fa-info text-info"></i> Use price range for variable costs</li>
                    <li><i class="fas fa-info text-info"></i> Use exact price for fixed procedures</li>
                    <li><i class="fas fa-info text-info"></i> Include all associated costs</li>
                    <li><i class="fas fa-info text-info"></i> Update prices regularly</li>
                </ul>

                <h6 class="mt-3">Content Tips</h6>
                <ul class="list-unstyled small">
                    <li><i class="fas fa-lightbulb text-warning"></i> Use clear, medical terminology</li>
                    <li><i class="fas fa-lightbulb text-warning"></i> Include benefits and risks</li>
                    <li><i class="fas fa-lightbulb text-warning"></i> Mention recovery time</li>
                    <li><i class="fas fa-lightbulb text-warning"></i> Add pre/post procedure care</li>
                </ul>

                <h6 class="mt-3">Image Guidelines</h6>
                <ul class="list-unstyled small">
                    <li><i class="fas fa-camera text-info"></i> Professional medical images</li>
                    <li><i class="fas fa-camera text-info"></i> Before/after comparisons</li>
                    <li><i class="fas fa-camera text-info"></i> Equipment and facility photos</li>
                    <li><i class="fas fa-camera text-info"></i> Maintain patient privacy</li>
                </ul>
            </div>
        </div>

        <!-- Treatment Types Info -->
        <div class="card mt-3">
            <div class="card-header">
                <h6 class="card-title mb-0"><i class="fas fa-list"></i> Treatment Types</h6>
            </div>
            <div class="card-body">
                <small class="text-muted">
                    <strong>Surgery:</strong> Operative procedures<br>
                    <strong>Medical:</strong> Non-surgical treatments<br>
                    <strong>Diagnostic:</strong> Tests and examinations<br>
                    <strong>Therapy:</strong> Rehabilitation services<br>
                    <strong>Preventive:</strong> Health maintenance<br>
                    <strong>Cosmetic:</strong> Aesthetic procedures<br>
                    <strong>Emergency:</strong> Urgent care
                </small>
            </div>
        </div>
    </div>
</div>

<!-- New Treatment Type Modal -->
<div class="modal fade" id="newTypeModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add New Treatment Type</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="newTypeForm">
                    <div class="mb-3">
                        <label for="newTypeName" class="form-label">Treatment Type Name <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="newTypeName" name="type_name" required 
                               placeholder="e.g., Orthopedic Surgery">
                        <div class="form-text">Enter a unique treatment type name</div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="addNewType()">Add Type</button>
            </div>
        </div>
    </div>
</div>

<!-- Rename Treatment Type Modal -->
<div class="modal fade" id="renameTypeModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Rename Treatment Type</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="renameTypeForm">
                    <div class="mb-3">
                        <label for="currentTypeName" class="form-label">Current Name</label>
                        <input type="text" class="form-control" id="currentTypeName" readonly>
                    </div>
                    <div class="mb-3">
                        <label for="newTypeNameRename" class="form-label">New Name <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="newTypeNameRename" name="new_type_name" required 
                               placeholder="Enter new treatment type name">
                        <div class="form-text">This will rename the treatment type globally</div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-warning" onclick="renameType()">
                    <i class="fas fa-edit"></i> Rename Type
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Delete Treatment Type Modal -->
<div class="modal fade" id="deleteTypeModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Delete Treatment Type</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-triangle"></i>
                    <strong>Warning!</strong> This action cannot be undone.
                </div>
                <p>Are you sure you want to delete the treatment type:</p>
                <p><strong id="typeToDelete"></strong></p>
                <p class="text-muted">
                    <i class="fas fa-info-circle"></i> 
                    This will remove the treatment type from all treatments using it. 
                    Affected treatments will need to be reassigned to other types.
                </p>
                <div class="mb-3">
                    <label for="replacementType" class="form-label">Replace with (Optional)</label>
                    <select class="form-select" id="replacementType">
                        <option value="">Leave treatments without type</option>
                    </select>
                    <div class="form-text">Choose a replacement type for existing treatments</div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" onclick="deleteType()">
                    <i class="fas fa-trash"></i> Delete Type
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
// Form enhancement and validation
document.addEventListener('DOMContentLoaded', function() {
    // Price type toggle
    const priceRangeRadio = document.getElementById('price_range');
    const priceExactRadio = document.getElementById('price_exact_radio');
    const priceRangeFields = document.getElementById('price_range_fields');
    const priceExactField = document.getElementById('price_exact_field');

    function togglePriceFields() {
        if (priceRangeRadio.checked) {
            priceRangeFields.style.display = 'flex';
            priceExactField.style.display = 'none';
            document.getElementById('price_exact').value = '';
        } else if (priceExactRadio.checked) {
            priceRangeFields.style.display = 'none';
            priceExactField.style.display = 'flex';
            document.getElementById('price_min').value = '';
            document.getElementById('price_max').value = '';
        }
    }

    priceRangeRadio.addEventListener('change', togglePriceFields);
    priceExactRadio.addEventListener('change', togglePriceFields);

    // Initial toggle
    togglePriceFields();

    // Character count for short description
    const shortDescInput = document.getElementById('short_description');
    shortDescInput.addEventListener('input', function() {
        const length = this.value.length;
        const helpText = this.nextElementSibling;
        helpText.textContent = `${length}/200 characters - Brief summary for listings`;
        
        if (length > 200) {
            this.classList.add('is-invalid');
        } else {
            this.classList.remove('is-invalid');
        }
    });

    // Hospital/Doctor dropdown dependencies
    const hospitalSelect = document.getElementById('hospital_id');
    const doctorSelect = document.getElementById('doctor_id');
    
    hospitalSelect.addEventListener('change', function() {
        if (this.value) {
            // Filter doctors based on selected hospital
            // This would require AJAX call to get doctors for specific hospital
        }
    });

    // Price validation
    const priceMinInput = document.getElementById('price_min');
    const priceMaxInput = document.getElementById('price_max');
    
    priceMinInput.addEventListener('input', function() {
        const minVal = parseFloat(this.value);
        const maxVal = parseFloat(priceMaxInput.value);
        
        if (maxVal && minVal && minVal > maxVal) {
            this.setCustomValidity('Minimum price cannot be greater than maximum price');
        } else {
            this.setCustomValidity('');
        }
    });

    priceMaxInput.addEventListener('input', function() {
        const minVal = parseFloat(priceMinInput.value);
        const maxVal = parseFloat(this.value);
        
        if (minVal && maxVal && maxVal < minVal) {
            this.setCustomValidity('Maximum price cannot be less than minimum price');
        } else {
            this.setCustomValidity('');
        }
    });
});

// Treatment Type Management Functions
function showNewTypeModal() {
    document.getElementById('newTypeName').value = '';
    new bootstrap.Modal(document.getElementById('newTypeModal')).show();
}

async function addNewType() {
    const typeName = document.getElementById('newTypeName').value.trim();
    
    if (!typeName) {
        alert('Please enter a treatment type name.');
        return;
    }
    
    // Check if type already exists in current dropdown
    const select = document.getElementById('treatment_type');
    const existingOptions = Array.from(select.options).map(option => option.value.toLowerCase());
    
    if (existingOptions.includes(typeName.toLowerCase())) {
        alert('This treatment type already exists in the current list.');
        return;
    }
    
    try {
        // Fetch current types from database to double-check
        const response = await fetch('/admin/api/treatment-types');
        const data = await response.json();
        
        if (data.treatment_types && data.treatment_types.map(t => t.toLowerCase()).includes(typeName.toLowerCase())) {
            alert('This treatment type already exists in the database.');
            return;
        }
        
        // Add new option to select
        const newOption = document.createElement('option');
        newOption.value = typeName;
        newOption.textContent = typeName;
        newOption.selected = true;
        
        // Insert in alphabetical order
        const options = Array.from(select.options).slice(1); // Skip the first "Select Type" option
        let inserted = false;
        
        for (let i = 0; i < options.length; i++) {
            if (typeName.toLowerCase() < options[i].value.toLowerCase()) {
                select.insertBefore(newOption, options[i]);
                inserted = true;
                break;
            }
        }
        
        if (!inserted) {
            select.appendChild(newOption);
        }
        
        // Close modal
        bootstrap.Modal.getInstance(document.getElementById('newTypeModal')).hide();
        
        // Show success message
        showSuccessMessage(`New treatment type "${typeName}" has been added locally. It will be saved when you submit the form.`);
        
    } catch (error) {
        console.error('Error checking treatment types:', error);
        // Still allow adding locally even if API fails
        const newOption = document.createElement('option');
        newOption.value = typeName;
        newOption.textContent = typeName;
        newOption.selected = true;
        select.appendChild(newOption);
        
        bootstrap.Modal.getInstance(document.getElementById('newTypeModal')).hide();
        showSuccessMessage(`New treatment type "${typeName}" has been added locally.`);
    }
}

function showRenameTypeModal() {
    const select = document.getElementById('treatment_type');
    const selectedType = select.value;
    
    if (!selectedType) {
        alert('Please select a treatment type to rename.');
        return;
    }
    
    document.getElementById('currentTypeName').value = selectedType;
    document.getElementById('newTypeNameRename').value = selectedType;
    new bootstrap.Modal(document.getElementById('renameTypeModal')).show();
}

async function renameType() {
    const currentName = document.getElementById('currentTypeName').value;
    const newName = document.getElementById('newTypeNameRename').value.trim();
    
    if (!newName) {
        alert('Please enter a new treatment type name.');
        return;
    }
    
    if (currentName === newName) {
        alert('The new name must be different from the current name.');
        return;
    }
    
    try {
        const response = await fetch('/admin/api/treatment-types/rename', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                old_name: currentName,
                new_name: newName
            })
        });
        
        if (response.ok) {
            // Update all options with the old name
            const select = document.getElementById('treatment_type');
            Array.from(select.options).forEach(option => {
                if (option.value === currentName) {
                    option.value = newName;
                    option.textContent = newName;
                }
            });
            
            bootstrap.Modal.getInstance(document.getElementById('renameTypeModal')).hide();
            showSuccessMessage(`Treatment type renamed from "${currentName}" to "${newName}".`);
        } else {
            const error = await response.json();
            alert(`Error renaming treatment type: ${error.detail || 'Unknown error'}`);
        }
    } catch (error) {
        console.error('Error renaming treatment type:', error);
        alert('Error renaming treatment type. Please try again.');
    }
}

function showDeleteTypeModal() {
    const select = document.getElementById('treatment_type');
    const selectedType = select.value;
    
    if (!selectedType) {
        alert('Please select a treatment type to delete.');
        return;
    }
    
    document.getElementById('typeToDelete').textContent = selectedType;
    
    // Populate replacement dropdown
    const replacementSelect = document.getElementById('replacementType');
    replacementSelect.innerHTML = '<option value="">Leave treatments without type</option>';
    
    Array.from(select.options).forEach(option => {
        if (option.value && option.value !== selectedType) {
            const replaceOption = document.createElement('option');
            replaceOption.value = option.value;
            replaceOption.textContent = option.value;
            replacementSelect.appendChild(replaceOption);
        }
    });
    
    new bootstrap.Modal(document.getElementById('deleteTypeModal')).show();
}

async function deleteType() {
    const typeToDelete = document.getElementById('typeToDelete').textContent;
    const replacementType = document.getElementById('replacementType').value;
    
    try {
        const response = await fetch('/admin/api/treatment-types/delete', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                type_name: typeToDelete,
                replacement_type: replacementType || null
            })
        });
        
        if (response.ok) {
            // Remove the option from select
            const select = document.getElementById('treatment_type');
            Array.from(select.options).forEach(option => {
                if (option.value === typeToDelete) {
                    option.remove();
                }
            });
            
            // Reset selection if the deleted type was selected
            if (select.value === typeToDelete) {
                select.value = '';
                updateTypeButtons();
            }
            
            bootstrap.Modal.getInstance(document.getElementById('deleteTypeModal')).hide();
            showSuccessMessage(`Treatment type "${typeToDelete}" has been deleted.`);
        } else {
            const error = await response.json();
            alert(`Error deleting treatment type: ${error.detail || 'Unknown error'}`);
        }
    } catch (error) {
        console.error('Error deleting treatment type:', error);
        alert('Error deleting treatment type. Please try again.');
    }
}

function updateTypeButtons() {
    const select = document.getElementById('treatment_type');
    const renameBtn = document.getElementById('renameTypeBtn');
    const deleteBtn = document.getElementById('deleteTypeBtn');
    
    const hasSelection = select.value !== '';
    renameBtn.disabled = !hasSelection;
    deleteBtn.disabled = !hasSelection;
}

// Add event listener for treatment type selection changes
document.addEventListener('DOMContentLoaded', function() {
    const treatmentTypeSelect = document.getElementById('treatment_type');
    treatmentTypeSelect.addEventListener('change', updateTypeButtons);
    updateTypeButtons(); // Initial state
});

function showSuccessMessage(message) {
    const successMsg = document.createElement('div');
    successMsg.className = 'alert alert-success alert-dismissible fade show mt-2';
    successMsg.innerHTML = `
        <strong>Success!</strong> ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    // Insert after the treatment type field
    const treatmentTypeDiv = document.getElementById('treatment_type').closest('.col-md-6');
    treatmentTypeDiv.appendChild(successMsg);
    
    // Auto dismiss after 5 seconds
    setTimeout(() => {
        if (successMsg && successMsg.parentNode) {
            successMsg.remove();
        }
    }, 5000);
}
</script>
{% endblock %}